# tests/test_main.py
import pytest
import asyncio
import atexit

# Add this function to force cleanup
def exit_gracefully():
    """Force cleanup of async resources"""
    loop = asyncio.get_event_loop()
    if loop.is_running():
        loop.stop()
    loop.run_until_complete(loop.shutdown_asyncgens())
    loop.close()

# Register the cleanup function
atexit.register(exit_gracefully)