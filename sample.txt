from fastapi import FastAPI
from apscheduler.schedulers.background import BackgroundScheduler
import time

app = FastAPI()

# Function with arguments
def my_scheduled_task(name: str, count: int):
    print(f"[{time.strftime('%Y-%m-%d %H:%M:%S')}] Task executed - Name: {name}, Count: {count}")

# Start the scheduler
scheduler = BackgroundScheduler()

# Schedule at 12:00 AM
scheduler.add_job(my_scheduled_task, "cron", hour=0, minute=0, args=["Task1", 1])

# Schedule at 12:02 AM
scheduler.add_job(my_scheduled_task, "cron", hour=0, minute=2, args=["Task2", 2])

scheduler.start()

@app.get("/")
def read_root():
    return {"message": "FastAPI with APScheduler (Scheduled at 12:00 AM & 12:02 AM)"}

# Stop the scheduler when the app shuts down
@app.on_event("shutdown")
def shutdown_event():
    scheduler.shutdown()