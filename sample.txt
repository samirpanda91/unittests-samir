from fastapi.testclient import TestClient
from app import app

client = TestClient(app)

def test_download_script():
    # Send a GET request to the download endpoint
    response = client.get("/download-script")
    
    # Check if the response status code is 200
    assert response.status_code == 200, "Failed to download the file"
    
    # Check the content disposition header to verify the file download
    assert (
        response.headers["content-disposition"] == 'attachment; filename="script.py"'
    ), "Incorrect file name in the response"
    
    # Verify the file content (optional)
    with open("files/script.py", "rb") as f:
        expected_content = f.read()
    assert response.content == expected_content, "File content does not match"

    # Check the content type
    assert (
        response.headers["content-type"] == "application/octet-stream"
    ), "Incorrect content type"